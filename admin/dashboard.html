<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bonamigo - Panel Administrativo</title>
<link rel="stylesheet" href="../css/styles.css">
<link rel="stylesheet" href="../css/admin.css">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="icon" type="image/png" href="../img/logo_bonamigo.png">
</head>
<body class="admin-body">
<div class="admin-container">
  <!-- Overlay para mÃ³viles -->
  <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>
  
  <!-- Sidebar -->
  <aside class="admin-sidebar" id="admin-sidebar">
    <div class="sidebar-header">
      <img src="../img/logo.png" alt="Bonamigo" class="sidebar-logo">
      <h2 id="sidebar-user-name">Cargando...</h2>
    </div>
    
    <nav class="sidebar-nav">
      <a href="dashboard.html" class="nav-item active" data-page="dashboard">
        <span class="nav-icon">ğŸ“Š</span>
        <span>Dashboard</span>
      </a>
      <a href="productos.html" class="nav-item" data-page="productos">
        <span class="nav-icon">ğŸ“¦</span>
        <span>Productos</span>
      </a>
      <a href="categorias.html" class="nav-item" data-page="categorias">
        <span class="nav-icon">ğŸ·ï¸</span>
        <span>CategorÃ­as</span>
      </a>
      <a href="ventas.html" class="nav-item" data-page="ventas">
        <span class="nav-icon">ğŸ’°</span>
        <span>Ventas</span>
      </a>
      <a href="compras.html" class="nav-item" data-page="compras">
        <span class="nav-icon">ğŸ›’</span>
        <span>Compras</span>
      </a>
      <a href="estadisticas.html" class="nav-item" data-page="estadisticas">
        <span class="nav-icon">ğŸ“ˆ</span>
        <span>EstadÃ­sticas</span>
      </a>
    </nav>
    
    <div class="sidebar-footer">
      <button id="logout-btn" class="btn-logout">Cerrar SesiÃ³n</button>
      <a href="../index.html" class="link-site">â† Ver sitio</a>
    </div>
  </aside>
  
  <!-- Main Content -->
  <main class="admin-main">
    <header class="admin-header">
      <button class="menu-toggle" onclick="toggleSidebar()">â˜°</button>
      <h1>Dashboard</h1>
      <div class="header-user">
        <span id="user-name">Admin</span>
      </div>
    </header>
    
    <div class="admin-content" id="admin-content">
      <!-- Contenido se carga dinÃ¡micamente segÃºn la pÃ¡gina -->
      <div class="dashboard-grid">
        <div class="stat-card">
          <div class="stat-icon">ğŸ“¦</div>
          <div class="stat-info">
            <h3 id="stat-productos">0</h3>
            <p>Productos</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">â­</div>
          <div class="stat-info">
            <h3 id="stat-destacados">0</h3>
            <p>Destacados</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">ğŸ’°</div>
          <div class="stat-info">
            <h3 id="stat-ventas">$0</h3>
            <p>Ventas del Mes</p>
          </div>
        </div>
        
        <div class="stat-card warning">
          <div class="stat-icon">âš ï¸</div>
          <div class="stat-info">
            <h3 id="stat-alertas">0</h3>
            <p>Alertas de Stock</p>
          </div>
        </div>
      </div>
      
      <div class="dashboard-alerts">
        <h2>Alertas de Stock</h2>
        <div id="alertas-container" class="alertas-list"></div>
      </div>
    </div>
  </main>
</div>

<script src="../js/config.js"></script>
<script src="../js/admin.js"></script>
<script>
// FunciÃ³n helper para API
const apiFetch = window.apiRequest || fetch;

// Verificar autenticaciÃ³n - siempre pedir login
apiFetch('/api/session')
  .then(res => res.json())
  .then(data => {
    if (!data.authenticated) {
      // Forzar logout y redirigir
      apiFetch('/api/logout', { method: 'POST' }).finally(() => {
        window.location.href = 'login.html';
      });
    } else {
      document.getElementById('user-name').textContent = data.usuario;
      const sidebarUserName = document.getElementById('sidebar-user-name');
      if (sidebarUserName) {
        sidebarUserName.textContent = data.usuario;
      }
      cargarEstadisticas();
    }
  })
  .catch(() => {
    window.location.href = 'login.html';
  });

// Logout
document.getElementById('logout-btn').addEventListener('click', async () => {
  await apiFetch('/api/logout', { method: 'POST' });
  window.location.href = 'login.html';
});

// Cargar estadÃ­sticas del dashboard
async function cargarEstadisticas() {
  try {
    const response = await apiFetch('/api/estadisticas');
    const stats = await response.json();
    
    document.getElementById('stat-productos').textContent = stats.totalProductos || 0;
    document.getElementById('stat-destacados').textContent = stats.productosDestacados || 0;
    document.getElementById('stat-ventas').textContent = '$' + (stats.ventasMes || 0).toLocaleString('es-AR');
    document.getElementById('stat-alertas').textContent = (stats.productosStockBajo || 0) + (stats.productosSinStock || 0);
    
    // Mostrar alertas
    const alertasContainer = document.getElementById('alertas-container');
    alertasContainer.innerHTML = '';
    
    if (stats.alertasSinStock && stats.alertasSinStock.length > 0) {
      const sinStockDiv = document.createElement('div');
      sinStockDiv.className = 'alerta-item error';
      sinStockDiv.innerHTML = `
        <h4>Sin Stock (${stats.alertasSinStock.length})</h4>
        <ul>
          ${stats.alertasSinStock.map(p => `<li>${p.nombre}</li>`).join('')}
        </ul>
      `;
      alertasContainer.appendChild(sinStockDiv);
    }
    
    if (stats.alertasStockBajo && stats.alertasStockBajo.length > 0) {
      const stockBajoDiv = document.createElement('div');
      stockBajoDiv.className = 'alerta-item warning';
      stockBajoDiv.innerHTML = `
        <h4>Stock Bajo (${stats.alertasStockBajo.length})</h4>
        <ul>
          ${stats.alertasStockBajo.map(p => `<li>${p.nombre} - Stock: ${p.stock}</li>`).join('')}
        </ul>
      `;
      alertasContainer.appendChild(stockBajoDiv);
    }
    
    if (alertasContainer.children.length === 0) {
      alertasContainer.innerHTML = '<p class="no-alertas">No hay alertas de stock</p>';
    }
  } catch (error) {
    console.error('Error al cargar estadÃ­sticas:', error);
  }
}
</script>
</body>
</html>


